# 布局预设功能说明

## 功能概述

新增3个布局预设按钮，可以快速保存和加载摄像头布局配置。

## 按钮布局

### 第一行：快捷操作
```
[显示全部] [重置布局]
```

### 第二行：布局预设
```
[预设1🟢] [预设2🔵] [预设3🟠]
```

- **预设1**: 绿色 (#4CAF50)
- **预设2**: 蓝色 (#2196F3)
- **预设3**: 橙色 (#FF9800)

## 使用方法

### 1. 保存布局预设

**步骤**:
1. 调整好摄像头位置、大小、可见性
2. 点击预设按钮（预设1/2/3）
3. 选择"保存当前布局"
4. 提示"已保存到预设X"

**保存内容**:
- 4个摄像头的位置 (x, y 坐标)
- 4个摄像头的缩放比例 (30%~300%)
- 4个摄像头的可见性 (显示/隐藏)

### 2. 加载布局预设

**步骤**:
1. 点击预设按钮（预设1/2/3）
2. 选择"加载此预设"
3. 所有摄像头立即应用预设布局
4. 提示"已加载预设X"

**如果预设为空**:
- 提示"预设X为空，请先保存"
- 不会改变当前布局

### 3. 清除预设

**步骤**:
1. **长按**预设按钮
2. 确认对话框点击"确定"
3. 预设被清除
4. 提示"已清除预设X"

## 应用场景

### 场景1: 全屏录制模式
- **预设1**: 4个摄像头都放大到最大，平铺显示
- 用途: 需要看清所有细节时

### 场景2: 专注前方模式
- **预设2**: 前摄像头最大，其他3个缩小或隐藏
- 用途: 主要关注前方道路

### 场景3: 左右盲区监控
- **预设3**: 左右摄像头放大，前后缩小
- 用途: 关注车辆两侧情况

## 交互细节

### 点击预设按钮
弹出选择对话框:
```
预设 1
━━━━━━━━━━━━━
○ 保存当前布局
○ 加载此预设
━━━━━━━━━━━━━
      [取消]
```

### 长按预设按钮
弹出确认对话框:
```
清除预设
━━━━━━━━━━━━━━━━
确定要清除预设1吗？
━━━━━━━━━━━━━━━━
  [取消]  [确定]
```

## 数据存储

### 存储结构
```
SharedPreferences: floating_camera_prefs

预设1数据:
- preset1_front_visible: boolean
- preset1_front_x: int
- preset1_front_y: int
- preset1_front_scale: float
- preset1_back_visible: boolean
- preset1_back_x: int
- preset1_back_y: int
- preset1_back_scale: float
... (left, right 同理)

预设2数据:
- preset2_front_visible: boolean
... (结构相同)

预设3数据:
- preset3_front_visible: boolean
... (结构相同)
```

### 数据独立性
- 每个预设独立存储
- 互不影响
- 可以单独清除

## 技术实现

### 核心方法

#### `saveLayoutPreset(int presetNumber, ...)`
保存当前布局到指定预设:
- 遍历4个摄像头
- 读取当前位置、缩放、可见性
- 写入预设命名空间

#### `loadLayoutPreset(int presetNumber, ...)`
从预设加载布局:
- 检查预设是否存在
- 读取预设数据
- 应用到4个摄像头
- 同步更新当前状态

#### `hasPreset(int presetNumber)`
检查预设是否存在:
- 查询是否有任一摄像头数据
- 用于判断是否可清除

### 状态同步
加载预设时会同步更新当前状态:
```java
// 加载预设位置
cameraFrame.setX(x);
saveCameraPosition(cameraId, x, y);  // 同步到当前状态

// 加载预设缩放
cameraFrame.setLayoutParams(params);
prefs.edit().putFloat(cameraId + "_scale", scale).apply();  // 同步
```

确保预设加载后，当前状态与预设一致。

## 与现有功能的关系

### "显示全部"按钮
- 快速显示所有隐藏的摄像头
- 不改变位置和大小
- 不影响预设数据

### "重置布局"按钮
- 清除**当前状态**，恢复默认
- **不清除预设数据**
- 预设仍可加载使用

### 区别对比

| 功能 | 当前状态 | 预设1 | 预设2 | 预设3 |
|------|---------|------|------|------|
| 显示全部 | ✓修改 | - | - | - |
| 重置布局 | ✓清除 | - | - | - |
| 保存预设X | - | ✓保存 | ✓保存 | ✓保存 |
| 加载预设X | ✓覆盖 | ✓读取 | ✓读取 | ✓读取 |
| 清除预设X | - | ✓删除 | ✓删除 | ✓删除 |

## 使用建议

### 推荐预设配置

**预设1 - 全景模式**:
- 4个摄像头都显示
- 大小适中（100%~120%）
- 均匀分布四角
- 用途: 全方位监控

**预设2 - 前方专注**:
- 前摄像头放大（150%~200%）
- 后摄像头中等（80%~100%）
- 左右摄像头缩小（50%~70%）或隐藏
- 用途: 高速行驶

**预设3 - 侧方监控**:
- 左右摄像头放大（150%~180%）
- 前摄像头中等（100%）
- 后摄像头缩小（60%~80%）
- 用途: 并线、狭窄路段

### 操作技巧

1. **先调整，后保存**
   - 细心调整到最佳布局
   - 测试录制效果
   - 满意后再保存到预设

2. **多场景配置**
   - 不同场景使用不同预设
   - 快速切换提高效率

3. **定期更新**
   - 使用习惯改变后重新保存
   - 覆盖旧预设无需清除

4. **善用长按**
   - 不需要的预设及时清除
   - 保持预设列表干净

## 修改的文件

1. **activity_main_l7_floating.xml**
   - 增加第二行布局（3个预设按钮）
   - 调整按钮间距和大小
   - 设置预设按钮颜色

2. **FloatingCameraManager.java**
   - 新增 `saveLayoutPreset()` 方法
   - 新增 `loadLayoutPreset()` 方法
   - 新增 `hasPreset()` 方法
   - 新增 `saveCameraStateToPreset()` 私有方法
   - 新增 `loadCameraStateFromPreset()` 私有方法

3. **MainActivity.java**
   - 新增 `setupPresetButtons()` 方法
   - 新增 `setupPresetButton()` 方法
   - 实现点击/长按事件处理

## 编译状态
✅ 编译成功
✅ 无错误
✅ APK 已生成

## 测试验证

### 测试1: 保存和加载
1. 调整摄像头布局
2. 保存到预设1
3. 随意改变布局
4. 加载预设1
5. ✅ 应恢复到保存时的状态

### 测试2: 多预设
1. 保存3种不同布局到预设1/2/3
2. 依次加载预设1/2/3
3. ✅ 每个预设都应正确加载

### 测试3: 清除预设
1. 长按预设按钮
2. 确认清除
3. 尝试加载该预设
4. ✅ 应提示"预设X为空"

### 测试4: 持久化
1. 保存布局到预设
2. 完全退出应用
3. 重新启动应用
4. 加载预设
5. ✅ 应正确恢复布局

## 优势总结

- ✅ 3个独立预设槽位
- ✅ 一键保存/加载
- ✅ 长按快速清除
- ✅ 数据持久化存储
- ✅ 直观的颜色区分
- ✅ 不影响现有功能
- ✅ 灵活的场景切换

现在你可以重新安装应用，调整好布局后保存到预设，然后在不同场景快速切换了！🎉
