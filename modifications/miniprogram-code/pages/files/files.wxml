<!--pages/files/files.wxml-->
<view class="container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{currentTab === 'photo' ? 'active' : ''}}" bindtap="switchTab" data-tab="photo">
      <text>ç…§ç‰‡</text>
    </view>
    <view class="tab {{currentTab === 'video' ? 'active' : ''}}" bindtap="switchTab" data-tab="video">
      <text>è§†é¢‘</text>
    </view>
  </view>

  <!-- æ–‡ä»¶åˆ—è¡¨ -->
  <view class="file-list" wx:if="{{files.length > 0}}">
    <view class="file-item {{!item.isUploaded ? 'not-uploaded' : ''}}" wx:for="{{files}}" wx:key="_id" bindtap="previewFile" data-file="{{item}}">
      <!-- ç¼©ç•¥å›¾ -->
      <view class="file-thumb">
        <image wx:if="{{item.thumbUrl || item.tempFileURL}}" src="{{item.thumbUrl || item.tempFileURL}}" mode="aspectFill"></image>
        <view wx:else class="file-placeholder">
          <text>{{currentTab === 'video' ? 'ğŸ¬' : 'ğŸ“·'}}</text>
        </view>
        <view class="video-duration" wx:if="{{currentTab === 'video' && item.duration}}">
          {{item.duration}}
        </view>
        <view class="video-icon" wx:if="{{currentTab === 'video' && item.isUploaded}}">
          <text>â–¶</text>
        </view>
        <!-- æœªä¸Šä¼ æ ‡è®° -->
        <view class="device-badge" wx:if="{{!item.isUploaded}}">
          <text>è®¾å¤‡</text>
        </view>
      </view>
      
      <!-- æ–‡ä»¶ä¿¡æ¯ -->
      <view class="file-info">
        <view class="file-name">{{item.fileName || 'æœªå‘½åæ–‡ä»¶'}}</view>
        <view class="file-meta">
          <text class="file-time">{{item.createTimeStr || 'æœªçŸ¥æ—¶é—´'}}</text>
          <text class="file-size" wx:if="{{item.fileSizeStr}}">{{item.fileSizeStr}}</text>
        </view>
        <view class="file-status" wx:if="{{!item.isUploaded}}">
          <text class="status-text">ä¿å­˜åœ¨è®¾å¤‡ä¸Š</text>
        </view>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="file-actions" catchtap="deleteFile" data-file="{{item}}">
        <view class="delete-icon">Ã—</view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && files.length === 0}}">
    <view class="empty-icon-wrapper">
      <text class="empty-icon-text">{{currentTab === 'video' ? 'ğŸ¬' : 'ğŸ“·'}}</text>
    </view>
    <view class="empty-text">æš‚æ— {{currentTab === 'video' ? 'è§†é¢‘' : 'ç…§ç‰‡'}}æ–‡ä»¶</view>
    <view class="empty-tip">è¿œç¨‹å½•åƒæˆ–æ‹ç…§åï¼Œæ–‡ä»¶ä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- åŠ è½½æ›´å¤šæç¤º -->
  <view class="load-more" wx:if="{{!loading && files.length > 0}}">
    <text wx:if="{{hasMore}}">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    <text wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
